# 입력 스트림과 출력 스트림

- `입력 스트림`과 `출력 스트림`을 이용하면 외부 세계와 통신할 수 있다.
- 스트림은 문자 데이터를 끝없이 넣거나 가져올 수 있다.
- 입력 스트림과 출력스트림은
  - 1998년에 제정된 최초의 C++ 표준(C++98)보다도 훨씬 전부터 있던 개념이다.
  - 확장성을 제공하는 프레임워크를 위한 것이다.
  - 객체지향 및 제네릭 패러다임에 맞게 구현됐다.

### 계층 구조

- `basic_streambuf<>` : 데이터를 읽고 쓴다.
- `ios_base` : 모든 스트림 클래스에 있는, 문자 타입에 독립적인 속성이다.
- `basic_ios<>` 모든 스트림 클래스에 있는, 문자 타입에 종속적인 속성이다.
- `basic_istream<>` : 데이터를 읽는 스트림 클래스의 베이스다.
- `basic_ostream<>` : 데이터를 쓰는 스트림 클래스의 베이스다.
- `basic_iostream<>` : 데이터를 읽거나 쓰는 스트림 클래스의 베이스다.
- 클래스 계층 구조는 문자 티입인 `char`와 `wchar_t`에 대한 타입 동의어를 제공한다. w로 시작하는 않는 이름은 `char`에 대한 타입 동의어이고, w로 시작하는 이름은 `wchar_t`에 대한 타입 동의어다.
- `std::basic_iostream<>`의 기본 클래스는 `std::basic_ios<>`를 가상 상속한 것이다. 따라서 `std::basic_iostream<>`은 `std::basic_ios`의 인스턴스를 단 하나만 갖는다.

### 입력 함수와 출력 함수

- 스트림 클래스인 `std::istream`과 `std::ostream`은 데이터를 읽고 쓰는데 흔히 사용된다. `std::istream`클래스는 `istream`헤더에, `std::ostream`은 `ostream`헤더에 정의돼 있다. `iostream`헤더는 두 클래스를 모두 선언하고 있다.
- `std::istream`은 `basic_istream` 클래스와 char를 typedef로 선언한 것이고, `std::ostream`은 basic_ostream 클래스를 typedef로 선언한 것이다.

```
typedef basic_istream<char> istream;
typedef basic_ostream<char> ostream;
```

- 미리 정의된 네 가지 스트림 오브젝트

---

| 스트림 오브젝트 | C 언어 표현 |  기기  | 버퍼 사용 |
| :-------------: | :---------: | :----: | :-------: |
|    std::cin     |    stdin    | 키보드 |     O     |
|    std::cout    |   stdout    | 모니터 |     O     |
|    std::cerr    |   stderr    | 모니터 |     X     |
|    std::clog    |             | 모니터 |     O     |

- 추가 연산자인 `<<`는 주어진 문자를 출력 스트림인 `std::cout`로 보낸다.
- 추출 연산자인 `>>`는 입력 스트림은 `std::cin`에서 문자를 가져온다.
- 이러한 추가 및 추출 연산자는 자기 자신에 대한 레퍼런스를 리턴하기 때문에 연산자를 계속 연결할 수 있다.
- 흔히 사용하는 스트림 조작자

---

|   조작자   | 스트림 타입 |                            설명                             |
| :--------: | :---------: | :---------------------------------------------------------: |
| std::endl  |    출력     | 줄바꿈 문자(new-line character)를 추가하고 스트림을 비운다. |
| std::flush |    출력     |                      스트림을 비운다.                       |
|  std::ws   |    입력     |               앞에 나온 공백 문자를 무시한다.               |

- ### 입력

  - `추출 연산자 >>`는 다음과 같은 속성이 있다.
    - 모든 내장 타입과 스트링에 대해 미리 정의돼 있다.
    - 사용자 정의 데이터 타입에 대해 구현할 수 있다.
    - 포맷 지정자로 설정할 수 있다.

- ### 포맷 비지정 입력

  - `입력 스트림 is`에 대해 포맷 비지정 입력 기능을 제공하는 메서드

  ***

  |                         메서드                         |                                                    설명                                                    |
  | :----------------------------------------------------: | :--------------------------------------------------------------------------------------------------------: |
  |                       is.get(ch)                       |                                     문자 하나를 읽어서 ch로 전달한다.                                      |
  |                    is.get(buf, num)                    |                               문자를 최대 num개 읽어서 buf 버퍼에 저장한다.                                |
  |             is.getline(buf, num[, delim])              | 문자를 최대 num가 읽어서 buf 버퍼에 저장한다. 옵션은 줄 구분자(line-delimeter, 디폴트 값은 \n)를 적용한다. |
  |                      is.gcount()                       |                    is에서 포맷 비지정 연산으로 가장 최근에 추출한 문자 개수를 리턴한다.                    |
  | is.ignore(streamsize, sz = 1, int delim = end-of-file) |                                 delim이 나올 떄까지 sz개 문자를 무시한다.                                  |
  |                       is.peek()                        |                                     is에서 문자를 꺼내지 않고 읽는다.                                      |
  |                       is.unget()                       |                                마지막으로 읽은 문자를 다시 is에 집어넣는다.                                |
  |                     is.putback(ch)                     |                                     문자 ch를 스트림 is에 집어넣는다.                                      |

- ### 출력

  - `추가 연산자 <<`를 사용하면 문자를 출력 스트림으로 보낼 수 있으며, 다음과 같은 속성이 있다.
    - 모든 내장 타입과 스트링에 대해 미리 정의돼 있다.
    - 사용자 정의 타입에 대해 구현할 수 있다.
    - 포맷 지정자로 데이터를 조정할 수 있다.

- ### 포맷 지정자
  - 포맷 지정자를 이용하면 입력과 출력 데이터를 직접 조정할 수 있다.
  - 불 값 출력하기
  ***
  |      조작자      | 스트림 타입 |               설명               |
  | :--------------: | :---------: | :------------------------------: |
  |  std::boolalpha  | 입력과 출력 |     불 값을 단어로 출력한다.     |
  | std::noboolalpha | 입력과 출력 | 불 값을 단어로 출력한다(디폴트). |
  - 필드 폭과 채우기 문자 설정하기
  ***
  |     조작자      | 스트림 타입 |                          설명                          |
  | :-------------: | :---------: | :----------------------------------------------------: |
  | std::setw(val)  | 입력과 출력 |               필드 폭을 val로 설정한다.                |
  | std::setfill(c) | 출력 스트림 | 채우기 문자(fill character)를 설정한다(디폴트는 공백). |
  - 텍스트 정렬
  ***
  |    조작자     | 스트림 타입 |                            설명                            |
  | :-----------: | :---------: | :--------------------------------------------------------: |
  |   std::left   |    출력     |                 출력을 왼쪽으로 정렬한다.                  |
  |  std::right   |    출력     |                출력을 오른쪽으로 정렬한다.                 |
  | std::internal |    출력     | 숫자의 부호는 왼쪽으로 정렬하고, 값은 오른쪽으로 정렬한다. |
  - 양의 부호와 대소문자
  ***
  |     조작자     | 스트림 타입 |                 설명                 |
  | :------------: | :---------: | :----------------------------------: |
  |  std::showpos  |    출력     |     양의 부호를 화면에 표시한다.     |
  | std::noshowpos |    출력     | 양의 부호를 화면에 표시한다(디폴트). |
  | std::uppercase |    출력     | 숫자 값을 대문자로 표시한다(디폴트). |
  | std::lowercase |    출력     |     숫자 값을 소문자로 표시한다.     |
  - 진수 표시
  ***
  |     조작자      | 스트림 타입 |                     설명                      |
  | :-------------: | :---------: | :-------------------------------------------: |
  |    std::oct     | 입력과 출력 |          자연수를 8진수로 표시한다.           |
  |    std::dec     | 입력과 출력 |      자연수를 10진수로 표시한다(디폴트).      |
  |    std::hex     | 입력과 출력 |          자연수를 16진수로 표시한다.          |
  |  std::showbase  |    출력     |        숫자의 진수를 화면에 표시한다.         |
  | std::noshowbase |    출력     | 숫자의 진수를 화면에 표시하지 않는다(디폴트). |
  - 부동 소스점 수는 다음과 같은 특별한 규칙이 적용된다.
    - 유효 숫자(콤마 뒤에 나오는 숫자)의 디폴트 개수는 6이다.
    - 유효 숫자의 개수가 충분히 크지 않으면 숫자를 과학 표기법으로 표시한다.
    - 앞과 뒤에 나오는 0은 화면에 표시하지 않는다.
    - 소수점은 가능하면 화면에 표시하지 않는다.
  - 부동소수점 수
  ***
  |         조작자         | 스트림 타입 |                          설명                          |
  | :--------------------: | :---------: | :----------------------------------------------------: |
  | std::setprecision(val) |    출력     |            출력의 정밀도를 val로 조정한다.             |
  |     std::showpoint     |    출력     |               소수점을 화면에 표시한다.                |
  |    std::noshowpoint    |    출력     |        소수점을 화면에 표시하지 않는다(디폴트).        |
  |       std::fixed       |    출력     |           부동소수점 수를 10진수로 표시한다.           |
  |    std::scientific     |    출력     |       부동소수점 수를 과학 표기법으로 표시한다.        |
  |     std::hexfloat      |    출력     |           부동소수점 수를 16진수로 표시한다.           |
  |   std::defaultfloat    |    출력     | 부동소수점 수를 디폴트 부동소수점 표기법으로 표시한다. |

### 스트림

- 스트림은 끝없이 이어지는 데이터의 흐름으로, 데이터를 넣거나 가져올 수 있다. `스트링 스트림`을 이용하면 스트링을 직접 다룰 수 있고, `파일 스트림`을 이용하면 파일을 직접 다룰 수 있다.

- ### 스트링 스트림

  - 스트링 스트림은 `sstream`헤더에 정의돼 있다.
  - 스트링 스트림은 클래스를 다양하게 제공한다.
    - `std::istringstream`과 `std::wistringstream` : `char`와 `wchar_t` 타입의 입력 데이터를 위한 스트링 스트림
    - `std::ostringstream`과 `std::wostringstream` : `char`와 `wchar_t` 타입의 출력 데이터를 위한 스트링 스트림
    - `std::stringstream`과 `std::wstringstream` : `char`와 `wchar_t` 타입의 입력 또는 출력 데이터를 위한 스트링 스트림
  - 스트링 스트림의 주요 연산
    - 스트링 스트림에 데이터 쓰기
    ```
    std::stringstream os;
    os << "New String";
    os.str("Another new String");
    ```
    - 스트링 스트림에서 데이터 읽기
    ```
    std::string os;
    std::string str;
    os >> str;
    str = os.str();
    ```
    - 스트링 스트림 비우기
    ```
    std::stringstream os;
    os.str("");
    ```

- ### 파일 스트림

  - 파일 스트림은 다양한 파일 스트림 클래스를 제공한다.
    - `std::ifstream`과 `std::wifstream` : `char`와 `wchar_t` 타입 입력 데이터를 위한 파일 스트림
    - `std::ofstream`과 `std::wofstream` : `char`와 `wchar_t` 타입 출력 데이터를 위한 파일 스트림
    - `std::fstream`과 `std::wfstream` : `char`와 `wchar_t` 타입 입력과 출력 데이터를 위한 파일 스트림
    - `std::filebuf`와 `std::wfilebuf` : `char`와 `wchar_t` 타입 데이터 버퍼
  - 파일 스트림 열기용 플래그

  ***

  |      플래그      |                              설명                              |
  | :--------------: | :------------------------------------------------------------: |
  |   std::ios::in   |                파일 스트림을 읽기 용도로 연다.                 |
  |  std::ios::out   |                파일 스트림을 쓰기 용도로 연다.                 |
  |  std::ios::app   |                파일 스트림 끝에 문자를 붙인다.                 |
  |  std::ios::ate   | 파일 스트림 끝에 대한 파일 위치 포인터의 초기 위치를 설정한다. |
  | std::ios::trunc  |                     원본 파일을 삭제한다.                      |
  | std::ios::binary |      파일 시스템에서 이스케이프 시퀀스를 해석하지 않는다.      |

  - C++와 C로 파일 열기

  ***

  |                   C++ 모드                   |        설명         | C 모드 |
  | :------------------------------------------: | :-----------------: | :----: |
  |                 std::ios::in                 |   파일을 읽는다.    |  "r"   |
  |                std::ios::out                 |    파일을 쓴다.     |  "w"   |
  |         std::ios::out, std::ios::app         |  파일에 추가한다.   |  "a"   |
  |         std::ios::in, std::ios::out          |  파일을 읽고 쓴다.  |  "r+"  |
  | std::ios::in, std::ios::out, std::ios::trunc | 파일을 쓰고 읽는다. |  "w+"  |

  - 파일 스트림의 수명 관리하기

  ***

  |          플래그          |                     설명                     |
  | :----------------------: | :------------------------------------------: |
  |    infile.open(name)     |      name이란 파일을 읽기 모드로 연다.       |
  | infile.open(name, flags) | flags를 적용해 name 파일을 읽기 모드로 연다. |
  |      infile.close()      |             name 파일을 닫는다.              |
  |     infile.is_open()     |         파일이 열려 있는지 확인한다.         |

  - 파일 스트림 위치 옮기기

  ***

  |        메서드         |                                   설명                                    |
  | :-------------------: | :-----------------------------------------------------------------------: |
  |     file.tellg()      |                       file의 읽기 위치를 리턴한다.                        |
  |     file.tellp()      |                       file의 쓰기 위치를 리턴한다.                        |
  |    file.seekg(pos)    |                    file의 읽기 위치를 pos로 설정한다.                     |
  |    file.seekp(pos)    |                    file의 쓰기 위치를 pos로 설정한다.                     |
  | file.seekg(off, rpos) | file의 읽기 위치를 rpos를 기준으로 옵센 off만큼 떨어진 지점으로 설정한다. |
  | file.seekp(off, rpos) | file의 쓰기 위치를 rpos를 기준으로 옵센 off만큼 떨어진 지점으로 설정한다. |

  - off는 반드시 숫자로 지정해야 한다. rpos는 다음과 같이 세 가지 값으로 지정한다.
    - `std::ios::beg` : 파일의 시작 위치
    - `std::ios::cur` : 파일의 현재 위치
    - `std::ios::end` : 파일의 끝 위치

- ### 스트림 상태
  - 플래그는 스트림의 상태를 표현한다. 플래그를 다루는 메서드는 `iostream` 헤더에 정의돼 있다.
  - 스트림 상태
  ***
  |      플래그       |  플래그 질의  |                 설명                  |
  | :---------------: | :-----------: | :-----------------------------------: |
  | std::ios::goodbit | stream.good() |    아무런 비트도 설정하지 않는다.     |
  | std::ios::eofbit  | stream.eof()  | 파일 끝(end-of-file) 비트를 설정한다. |
  | std::ios::failbit | stream.fail() |                 에러                  |
  | std::ios::badbit  | stream.bad()  |            비정상적인 동작            |
  - 스트림의 상태 변경되는 예는 다음과 같다.
    - `std::ios::eofbit` : 정상적인 문자를 벗어난 지점을 읽는 경우
    - `std::ios::failbit` : 포맷이 잘못된 부분을 읽는 경우, 정상적인 문자를 벗어난 지점을 읽는 경우, 파일 여는 과정에 문제가 발생한 경우
    - `std::ios::badbit` : 스트림 버퍼의 크기를 조정할 수 없는 경우, 스트림 버퍼의 코드 변환 과정에 문제가 발생한 경우, 스트림의 일부분에서 익셉션이 발생한 경우
  - `stream.fail()`은 `std::ios::failbit`나 `std::ios:;badbit`가 설정됐는지 여부를 리턴한다. 다음 메서드를 이용하면 스트림 상태를 읽거나 설정할 수 있다.
    - `stream.clear()` : 플래그를 초기화하고 스트림을 goodbit 상태로 설정한다.
    - `stream.clear(sta)` : 플래그를 초기화하고 스트림을 sta 상태로 설정한다.
    - `stream.rdstate()` : 현재 상태를 리턴한다.
    - `stream.setstate(fla)` : 플래그 fla를 추가로 설정한다.

### 사용자 정의 데이터 타입

- 입력 및 출력 연산자를 오버로딩하면 사용자 정의 데이터 타입을 기본 데이터 타입처럼 작동하게 만들 수 있다.

```
friend std::istream& operator>> (std::istream& in, Fraction& frac);
friend std::ostream& operator<< (std::ostream& out, const Fraction& frac);
```

- 입력 및 출력 연산자를 오버로딩하려면 다음 규칙을 지켜야 한다.
  - 입력 연산이나 출력 연산을 연달아 적용하려면 입력 스트림이나 출력 스트림을 입력받아서 `비상수 레퍼런스`로 리턴해야 한다.
  - `클래스의 사설 멤버`에 접근하려면 입력 연산자나 출력 연산자를 해당 데이터 타입에서 friend로 선언해야 한다.
  - `입력 연산자인 >>`는 데이터 타입을 비상수 레퍼런스로 받는다.
  - `출력 연산자인 <<`는 데이터 타입을 상수 레퍼런스로 받는다.
